#include "../tests.h"

VOID ExRunPoolTests()
{
    MWORD AllocSizes[] = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 1024, 512, 128, 256,
			   1207, 4075, 2002, 355, 1699, 908, 4060, 2249, 4520, 2654,
			   4997, 3448, 3031, 453, 4241, 894, 2290, 3338, 4030, 1537,
			   1539, 103, 134, 3062, 671, 1357, 1444, 1449, 4212, 2392,
			   773, 4901, 2539, 225, 1474, 587, 831, 2268, 1401, 2423,
			   584, 1201, 2439, 2351, 1965, 3761, 3273, 2728, 3939, 3134,
			   1677, 683, 22, 4067, 4837, 3452, 3281, 2125, 3697, 2933,
			   827, 3456, 3539, 434, 845, 205, 2947, 1204, 4801, 3199,
			   2860, 3563, 4313, 2063, 1183, 1383, 3736, 50, 4187, 1962,
			   2333, 4503, 3210, 3744, 3734, 1223, 1418, 4400, 1764, 1600,
			   235, 1495, 1037, 4914, 4239, 686, 4428, 4094, 4270, 2396,
			   687, 3843, 8, 2748, 2294, 3343, 1718, 2527, 649, 2914,
			   134, 1737, 2505, 3926, 4198, 1412, 661, 2116, 4671, 3131,
			   2062, 1139, 3873, 2187, 3138, 1899, 2302, 1182, 113, 1846,
			   2355, 1520, 2909, 895, 1966, 189, 3604, 997, 3138, 2744,
			   449, 2832, 3263, 4457, 4269, 992, 325, 589, 741, 1896,
			   89, 4677, 1693, 1850, 2041, 2277, 3, 2445, 4520, 4048,
			   4039, 3663, 333, 496, 8, 3790, 1279, 4870, 1069, 3870,
			   2254, 3298, 3388, 15, 1246, 3162, 25, 4218, 3105, 1882,
			   3191, 2158, 547, 26, 1545, 4732, 4426, 4908, 1747, 4726,
			   4339, 4588, 3373, 1249, 3623, 3947, 1193, 4131, 4137, 2587,
			   2751, 285, 4252, 3943, 1141, 2351, 2377, 2834, 1157, 2479,
			   2226, 1832, 4, 2116, 753, 1649, 4923, 2663, 2615, 4210,
			   1209, 4057, 3331, 1884, 4991, 389, 3885, 3464, 64, 2183,
			   3913, 1844, 4055, 2683, 1685, 1149, 832, 2537, 2746, 3168,
			   2817, 1896, 3024, 463, 3714, 1794, 393, 2402, 2158, 2673,
			   770, 4992, 1694, 3725, 4882, 1115, 3126, 1300, 238, 4110,
			   4063, 3862, 511, 3599, 2501, 1083, 4491, 4041, 1735, 4671,
			   358, 4787, 3332, 2157, 263, 2138, 3046, 4461, 500, 877,
			   2980, 2921, 4978, 3771, 3724, 150, 4456, 4927, 4367, 3903,
			   98, 4642, 3555, 4270, 2656, 362, 1845, 3795, 4408, 295,
			   3418, 4901, 2284, 3419, 3018, 117, 3596, 1005, 3430, 4351,
			   4459, 261, 1961, 3226, 3826, 4572, 4401, 3378, 4052, 3160,
			   117, 3395, 708, 4022, 981, 3746, 1375, 2873, 3931, 1586,
			   335, 704, 4941, 2861, 4273, 3879, 1903, 1478, 2557, 4031,
			   1602, 2770, 1374, 1984, 4930, 1083, 1069, 4776, 3663, 4115,
			   2843, 1557, 822, 4596, 4392, 644, 292, 2278, 260, 2333,
			   2022, 3915, 1891, 3073, 1014, 1724, 1755, 2813, 1932, 3711,
			   3539, 2605, 4439, 1569, 4583, 497, 702, 4095, 2162, 4956,
			   84, 3290, 1878, 2837, 1536, 3695, 2793, 2790, 224, 1645,
			   3647, 3185, 390, 1158, 3170, 2394, 3837, 247, 3119, 228,
			   372, 4889, 4429, 201, 2102, 3650, 4380, 556, 3022, 4330,
			   2451, 1880, 1365, 1808, 4790, 1205, 3541, 278, 4131, 92,
			   3304, 3175, 243, 1512, 4400, 2325, 184, 1824, 1453, 19,
			   4657, 409, 1310, 3300, 4633, 3281, 680, 2155, 4869, 3932,
			   2230, 2897, 2535, 2682, 663, 3540, 4566, 4337, 2594, 4258,
			   913, 3233, 4965, 245, 504, 847, 2065, 2025, 830, 1420,
			   3652, 1975, 1764, 1885, 4610, 580, 1708, 3738, 2091, 3752,
			   1361, 4863, 2401, 356, 1101, 3390, 1149, 494, 2321, 4705,
			   4153, 4300, 1598, 1068, 2099, 4475, 4480, 4124, 4823, 4803,
			   1701, 4488, 4186, 4286, 4864, 4927, 3559, 839, 645, 1329,
			   2451, 4688, 791, 4429, 4060, 23, 1140, 1336, 1653, 3928,
			   588, 4983, 3625, 3617, 386, 2519, 3792, 3834, 4291, 4959,
			   4774, 2847, 997, 4065, 137, 3175, 4822, 4354, 2047, 3122,
			   1442, 314, 3236, 4855, 3098, 4135, 2731, 4904, 3863, 4871,
			   1774, 3593, 3309, 2679, 1111, 3733, 3119, 1551, 2748, 1732,
			   1906, 1364, 4374, 3403, 1892, 175, 2688, 2415, 1931, 3826,
			   3022, 4039, 3382, 3834, 2015, 3437, 2998, 2372, 4352, 3473,
			   875, 3721, 1671, 4646, 832, 2306, 1688, 4109, 1624, 4276,
			   4765, 1383, 1970, 2281, 1839, 3137, 660, 1527, 619, 1075,
			   2002, 2842, 239, 397, 3877, 2180, 305, 4263, 3133, 2311,
			   755, 3057, 4653, 2372, 425, 232, 4929, 542, 3198, 1027,
			   909, 386, 1105, 2952, 3071, 4562, 1897, 1387, 1530, 1119,
			   4422, 145, 1186, 2145, 4196, 2795, 3555, 1106, 3108, 29,
			   4055, 4478, 318, 2533, 1393, 1766, 3907, 3655, 383, 3871,
			   110, 2505, 4983, 4266, 3233, 3385, 3034, 4579, 2209, 1671,
			   877, 2701, 4792, 4504, 131, 311, 639, 565, 4237, 234,
			   3112, 2099, 3258, 1675, 342, 2013, 6, 4434, 276, 2275,
			   3548, 2416, 2408, 4214, 4710, 1255, 4039, 3451, 4493, 1101,
			   1465, 2930, 1706, 2101, 556, 642, 1812, 461, 110, 3022,
			   347, 191, 4387, 2648, 2853, 4380, 1351, 3984, 2640, 1725,
			   3379, 706, 3808, 2717, 4381, 1165, 3810, 1299, 737, 3271,
			   4165, 1490, 3785, 555, 1392, 562, 2042, 2443, 2689, 3254,
			   3579, 3634, 524, 1288, 816, 3693, 1959, 4411, 1793, 318,
			   633, 2064, 3124, 3075, 2338, 4854, 666, 2898, 3026, 2168,
			   3790, 4591, 4361, 59, 4860, 3103, 1919, 313, 4274, 4125,
			   756, 4978, 1365, 3261, 1586, 1346, 836, 1209, 4806, 4513,
			   3880, 3572, 1402, 4038, 293, 4128, 4201, 787, 4085, 3064,
			   188, 294, 1372, 1291, 3038, 519, 4450, 3987, 641, 3615,
			   1385, 186, 2856, 2251, 1442, 3610, 4927, 4197, 4144, 1556,
			   3486, 2781, 4338, 3632, 357, 1352, 1594, 3460, 1071, 2385,
			   365, 1269, 3121, 1909, 2728, 382, 3463, 739, 1558, 4728,
			   1910, 3302, 2231, 371, 4142, 237, 1839, 530, 1503, 431,
			   1133, 3106, 4152, 978, 2017, 1722, 3012, 4932, 4734, 2179,
			   4610, 2812, 4756, 3617, 3360, 4821, 759, 4429, 4080, 2248,
			   4073, 751, 1891, 4677, 4172, 292, 3950, 4638, 3688, 4724,
			   3543, 3773, 4350, 653, 545, 570, 1598, 4992, 512, 644,
			   3695, 278, 214, 3379, 3646, 4227, 1461, 4146, 2576, 2240,
			   240, 4188, 358, 1463, 2645, 2645, 4318, 1626, 2340, 715,
			   183, 1372, 2310, 410, 1321, 318, 2974, 456, 4312, 2076,
			   938, 4087, 2027, 2695, 4788, 1578, 3665, 1967, 4061, 3855,
			   3354, 3843, 785, 494, 3736, 1187, 932, 2082, 3999, 1449,
			   4902, 3279, 2917, 1523, 4634, 1516, 1568, 399, 3279, 1927,
			   2293, 3387, 4692, 3164, 1571, 2305, 948, 959, 690, 4371,
			   4189, 93, 1873, 2782, 3123, 4742, 2177, 2516, 295, 405,
			   3571, 1555, 1409, 2508, 2113, 1540, 1226, 4312, 2680, 1371,
			   2146, 2280, 169, 4744, 2895, 3644, 1382, 1407, 4296, 3677,
			   241, 299, 1696, 4632, 555, 4441, 1751, 4135, 2509, 1424,
			   3283, 1024, 2597, 1998, 2422, 3612, 3329, 2473, 4262, 191,
			   4411, 4133, 1343, 154, 1156, 2744, 4809, 1077, 3828, 4988,
			   43, 258, 4284, 3321, 3442, 1437, 2991, 4168, 3603, 2338 };

    for (int i = 0; i < ARRAY_LENGTH(AllocSizes); i++) {
	DbgPrint("AllocSize = %4zd  Got pointer %p\n", AllocSizes[i],
		 ExAllocatePoolWithTag(AllocSizes[i], EX_POOL_TAG('T','E','S','T')));
    }

    for (int i = 0; i < 1024; i++) {
	DbgPrint("AllocSize = %4d  Got pointer %p\n", 4000,
		 ExAllocatePoolWithTag(4000, EX_POOL_TAG('T','E','S','T')));
    }
}
